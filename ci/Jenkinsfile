#!/usr/bin/env groovy


node {

    stage('checkout'){
        checkout scm
    }

    withCredentials([[
        $class : "UsernamePasswordMultiBinding",
        credentialsId: 'dockercreds',
        passwordVariable: 'GITHUB_PASSWORD',
        usernameVariable: 'GITHUB_USERNAME'
    ]]){
        stage('build docker'){

            sh """

                   docker-compose -f docker-compose.yml build
                   docker container ls --all
                   docker image list
                   echo "\${GITHUB_PASSWORD} | docker login --username="\${GITHUB_USERNAME} --password-stdin
                   docker tag mymoto/mymoto:latest rubelw/mymoto:latest
                   docker push rubelw/mymoto
                """
        }
    }


    stage('clean-up workspace'){
        step([$class: 'WsCleanup'])
    }

}